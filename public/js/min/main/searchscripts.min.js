import{validEmailCheck,phoneFormatter,imageEncode,relativeDate}from"/js/vFiers.js";const jobQueryParams=()=>{var e,a;a=[],e=window.location.search.split("&");for(let n=0;n<e.length;n++){var t=e[n].split("=")[1].replaceAll("%20"," ");a.push(t)}return{jobQuery:a[0],country:a[1],sub_division:a[2],view:a[3],referral:a[4],source:a[5]}},setSearchState=new Vue({el:"#searchBody",data:{display:{item_count:0,item_visible:1,page:{total:1,current:1,next:null},filter:{filtered:!1,job_Type:["full-time","part-time","seasonal","contract"],location:{country:"",s_div:""},sort:{see_latest:999999999999},company:"",matchArr:[]}},focus_data:{},pref:{f_comp:[],f_jobs:[],job_alerts:[],applied_to:[],ref:0},j_selected:!0,all_jobs:[],matched_filters:[]},methods:{setState:(e=0)=>{setTimeout(()=>{document.getElementsByClassName("loader__overlay")[0].style.display="none"},200);var a=document.getElementById("job__intermed"),t=JSON.parse(a.value);if(t.items.length>e){setSearchState.all_jobs=t.items,t.items.forEach(e=>{companyAutoComplete.data.src.includes(e.company_name_posted)||companyAutoComplete.data.src.push(`${e.company_name_posted}`),setSearchState.matched_filters.push(e.id)}),setSearchState.display.item_count=t.itemsTotal,setSearchState.display.page.total=t.pageTotal,setSearchState.display.current=t.curPage,setSearchState.display.next=t.nextPage,setSearchState.focus_data=t.items[e];var n,o=window.location.href;if(o.includes("&view"))n=o.split("&view")[0].replace("#","");else n=window.location.href.replace("#","");shareHandler.link=`${n}&view=${setSearchState.focus_data.id}&referral=${shareHandler.ref_generator()}&source=intouch`}setTimeout(()=>{a.parentNode.removeChild(a)},3e3),setTimeout(()=>{setSearchState.adHandler()},900)},changeFocus:e=>{setSearchState.all_jobs.forEach(a=>{if(a.id===e){setSearchState.focus_data=a;var t,n=window.location.href;if(n.includes("&view"))t=n.split("&view")[0].replace("#","");else t=window.location.href.replace("#","");shareHandler.link=`${t}&view=${a.id}&referral=${shareHandler.ref_generator()}&source=intouch`}})},relativeDate:e=>relativeDate(e),setUserPref:async()=>{const e=await fetch("/main/user/favourites").then(e=>e.json()).then(e=>e).catch(e=>({data:{fav_comp:[],fav_jobs:[],job_alerts:[],me:0}}));e.ok&&(setSearchState.pref.f_comp=e.data.fav_comp,setSearchState.pref.f_jobs=e.data.fav_jobs,setSearchState.pref.job_alerts=e.data.job_alerts,setSearchState.pref.ref=e.data.me)},filter__jobType:e=>{var a=setSearchState.display.filter.job_Type;if(a.includes(e)){var t=a.indexOf(e);a.splice(t,1)}else a.push(e);setSearchState.display.filter.job_Type=a;var n=0;setSearchState.all_jobs.forEach(e=>{a.includes(e.type)&&(n+=1)}),setSearchState.display.item_visible=n},setCompUrl:e=>`/main/company/profile?name=${e}`,alertHandler:()=>{},filterHandler:()=>{setSearchState.display.filter.filtered=!0,setSearchState.matched_filters=[];var e=setSearchState.display.filter;setSearchState.all_jobs.forEach(a=>{var t=0;return e.job_Type.includes(a.type)&&(t+=1),e.sort.see_latest<=a.created_at&&(t+=1),(a.loc_country.toLowerCase().includes(e.location.country.toLowerCase())||0===e.location.country.length)&&(t+=1),(a.loc_sub_division.toLowerCase().includes(e.location.s_div.toLowerCase())||0===e.location.s_div.length)&&(t+=1),(a.company_name_posted.toLowerCase().includes(e.company.toLowerCase())||0===e.company.length)&&(t+=1),5===t&&(setSearchState.matched_filters.push(a.id),!0)}),setTimeout(()=>{var e=document.getElementsByClassName("inline-ad-space"),a=document.querySelector(".result-scroll-body");for(let t=0;t<e.length;t++)a.removeChild(e[t]);setSearchState.adHandler()},700)},adHandler:()=>{setSearchState.display.filter.filtered?setSearchState.matched_filters.length:setSearchState.all_jobs.length,document.getElementsByClassName("inline-ad-space");var e=document.querySelector(".result-scroll-body"),a=(e.children,document.querySelectorAll(".job-card")),t='<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9149531285371942"crossorigin="anonymous"><\/script><ins class="adsbygoogle"style="display:block"data-ad-format="fluid"data-ad-layout-key="-ed+6k-30-ac+ty"data-ad-client="ca-pub-9149531285371942"data-ad-slot="1909465585"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script>';if(a.length>=8){var n=1;a.forEach((a,o)=>{var i=document.createElement("div");i.className="inline-ad-space",i.innerHTML=t,n%4==0&&"inline-ad-space"!==a.previousSibling.className&&"inline-ad-space"!==a.previousSibling.previousSibling.className&&e.insertBefore(i,a),n+=1})}else if(a.length<8&&a.length>0){var o=document.createElement("div");o.className="inline-ad-space",o.innerHTML=t,e.append(o),console.log("added")}},clearFilter:()=>{setSearchState.display.filter.job_Type=["full-time","part-time","seasonal","contract"],setSearchState.display.filter.location.country="",setSearchState.display.filter.location.s_div="",setSearchState.display.filter.company="",setSearchState.filterHandler(),setSearchState.adHandler(),setSearchState.display.filter.filtered=!1}}}),applicationHandler=new Vue({el:"#applicationModal",data:{listing:{id:"1",title:"",company:"",questions:[],routing:{}},u_Data:{name:"",email:"",phone:"",resume:"",answers:[],questions:[]},conditions:{step_one:{name:!1,email:!1,phone:!1,country:!1,resume:!1},step_two:{questions_answered:!1}},current_step:1,state:{processing:!0,complete:!1,rejected:!1}},methods:{setState:()=>{var e=setSearchState.focus_data;applicationHandler.listing.id=e.id,applicationHandler.listing.title=e.title,applicationHandler.listing.company=e.company_name_posted,applicationHandler.listing.questions=e.application_data.question_data,applicationHandler.listing.routing=e.application_data.additional_routing_data},stepCheck:async e=>{switch(e){case"1":var a=Object.values(applicationHandler.conditions.step_one),t=Object.keys(applicationHandler.conditions.step_one),n=0,o=[];for(let e=0;e<a.length;e++)a[e]?n+=1:o.push(t[e]);return n===a.length?{ok:!0,errors:o}:{ok:!1,errors:o};case"2":var i=document.querySelectorAll("#applicantQUESTIONANSWERInput"),l=[];o=[];return i.forEach((e,a)=>{e.value.length>0?l.push(e.value):o.push(a)}),applicationHandler.u_Data.answers=l,applicationHandler.u_Data.questions=applicationHandler.listing.questions,l.length===applicationHandler.listing.questions.length?{ok:!0,errors:o}:{ok:!1,errors:o}}},stepHandler:async e=>{switch(e){case"1":(a=await applicationHandler.stepCheck("1")).ok?applicationHandler.current_step=2:a.errors.forEach(e=>{var a=e.toUpperCase();setInvalid(a)});break;case"2":var a;(a=await applicationHandler.stepCheck("2")).ok?(applicationHandler.submit(),applicationHandler.state.processing=!0,applicationHandler.current_step=3):a.errors.forEach(e=>{document.querySelectorAll("#applicantQUESTIONANSWERInput")[e].classList="form-control is-invalid"})}},questionHandler:()=>{var e=document.querySelectorAll("#applicantQUESTIONANSWERInput"),a=[],t=[];return e.forEach((e,n)=>{e.value.length>0?a.push(e.value):t.push(n)}),applicationHandler.u_Data.answers=a,applicationHandler.u_Data.questions=applicationHandler.listing.questions,a.length===applicationHandler.listing.questions.length?{ok:!0,errors:t}:{ok:!1,errors:t}},fileHandler:async e=>{var a=e.currentTarget.id;let t="";var n=document.querySelector(`#${a}`).files[0],o=new FileReader;o.onload=(async()=>{t=o.result.replace("data:","").replace(/^.+,/,"");await(e=>{applicationHandler.u_Data.resume=e})(t)}),o.readAsDataURL(n)},goBack:()=>{var e=applicationHandler.current_step,a=e-=1;applicationHandler.current_step=a},submit:async()=>{var e=[];applicationHandler.u_Data.answers.forEach((a,t)=>{var n={id:t,question:applicationHandler.u_Data.questions[t],answer:a};e.push(n)});await fetch("/main/application/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:applicationHandler.listing.id,name:applicationHandler.u_Data.name,phone:applicationHandler.u_Data.phone,email:applicationHandler.u_Data.email,resume:applicationHandler.u_Data.resume,verified_companies_id:setSearchState.focus_data.id,application_test_data:JSON.stringify(e)})}).then(e=>e.json()).then(e=>{e.completed?(applicationHandler.state.complete=!0,applicationHandler.state.processing=!1,applicationHandler.state.rejected=!1):(applicationHandler.state.complete=!1,applicationHandler.state.processing=!1,applicationHandler.state.rejected=!0)})},resetState:()=>{applicationHandler.u_Data.name="",applicationHandler.u_Data.email="",applicationHandler.u_Data.phone="",applicationHandler.u_Data.resume="",applicationHandler.u_Data.answers="",applicationHandler.u_Data.questions="",applicationHandler.conditions.step_one.name=!1,applicationHandler.conditions.step_one.email=!1,applicationHandler.conditions.step_one.phone=!1,applicationHandler.conditions.step_one.country=!1,applicationHandler.conditions.step_one.resume=!1,applicationHandler.conditions.step_two.questions_answered=!1,applicationHandler.state.processing=!1,applicationHandler.state.comlete=!1,applicationHandler.state.rejected=!1,applicationHandler.current_step=1,$("#applicationModal").modal("hide")}}}),shareHandler=new Vue({el:"#shareModalCenter",data:{link_copied:!1,link:"",links:{facebook:"#",instagram:"#",whatsapp:"#",twitter:"#",website:"#",email:""},ref:"",description:`Someone thinks you would be interested in this job as a ${setSearchState.focus_data.title} at ${setSearchState.focus_data.company_name_posted}`},methods:{copyLink:()=>{shareHandler.link_copied=!0;var e=document.getElementById("shareUrlCopyInput");e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value),shareHandler.createShare("intouch")},ref_generator:()=>{var e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",a="";for(let t=0;t<32;t++){a+=e[Math.floor(Math.random()*e.length)]}return shareHandler.ref=a,a},urlGen:e=>{switch(e){case"fb":return shareHandler.links.facebook=`https://www.facebook.com/sharer.php?u=${shareHandler.link}`,`https://www.facebook.com/sharer.php?u=${shareHandler.link}`;case"tw":return shareHandler.links.twitter=`https://twitter.com/intent/tweet?original_referer=${shareHandler.link}&url=${shareHandler.link}`,`https://twitter.com/intent/tweet?original_referer=${shareHandler.link}&url=${shareHandler.link}`;case"wtp":return"#"}},createShare:async(e="intouch")=>{shareHandler.ref=shareHandler.ref_generator();await fetch("/analytics/share/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({job_id:setSearchState.focus_data.id,share_method:e,referral:shareHandler.ref})}).then(e=>e.json()).then(e=>{})}}}),notificationHandler=new Vue({el:".notif__display",data:{class:{unread__notif:"__unread__notif"},state:{loading:!0,complete:!1,failed:!1,last_update:null,menu_open:!1},notif:{display:[],remove:[]}},methods:{setState:async(e=0,a=null)=>{var t=new Date;if(e>0)await fetch("/alerts/notifications/mynotifications/receive",{method:"GET",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{notificationHandler.notif.display=e.items,notificationHandler.state.last_update=t.getTime(),notificationHandler.state.complete=!0,notificationHandler.state.failed=!1,console.log(e)}).catch(e=>{notificationHandler.state.failed=!0,notificationHandler.state.complete=!0,notificationHandler.state.last_update=t.getTime()});else notificationHandler.state.failed=!0,notificationHandler.state.complete=!0,notificationHandler.state.last_update=t.getTime()},setRelative:e=>relativeDate(e)}});var target_observe=document.querySelector(".notif__display"),options={rootMargin:"0px",threshold:.2},notifcallback=function(e,a){e.forEach(e=>{(new Date).getTime();e.isIntersecting&&null===notificationHandler.state.last_update&&notificationHandler.setState(setSearchState.pref.ref),e.isIntersecting?$("html").css("overflow","hidden"):$("html").css("overflowY","scroll")})},observer=new IntersectionObserver(notifcallback,options);observer.observe(target_observe);const jobautoSearch=()=>{fetch("/resources/alljobs.json").then(e=>e.json()).then(e=>{for(let a=0;a<e.length;a++)autoCompleteJS.data.src.push(e[a].title)})},autoCompleteJS=new autoComplete({placeholder:"Search for food...",data:{src:[]},resultItem:{highlight:{render:!0}},submit:!0}),companyAutoComplete=new autoComplete({placeholder:"Search by company",selector:"#filterCompanyInput",data:{src:[]},resultItem:{highlight:{render:!0}},submit:!0});console.log(companyAutoComplete),document.querySelector("#autoComplete").addEventListener("selection",function(e){var a=e.detail;e.currentTarget.value=a.selection.value,window.location.href=`/main/seejobs?q=${a.selection.value}&country=&sub_division=`}),window.location.href.includes("/company/profile")||document.querySelector("#filterCompanyInput").addEventListener("selection",function(e){var a=e.detail;e.currentTarget.value=a.selection.value,setSearchState.display.filter.company=a.selection.value,e.currentTarget.blur()});const setValid=e=>{document.getElementById(`applicant${e}Input`).classList="form-control is-valid"},setInvalid=e=>{document.getElementById(`applicant${e}Input`).classList="form-control is-invalid"},main=()=>{$(".act-btn").on("click",e=>{$(e.currentTarget).toggleClass("button-active")}),$(".switch__outer").on("click",e=>{$(e.currentTarget).toggleClass("toggled")}),$("#favourite__handle").on("click",async()=>{await fetch("/me/edit/preferences",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({update_Type:"fav_jobs_add",f_comp:"",f_jobs:setSearchState.focus_data.id,job_alerts:""})}).then(e=>e.json()).then(e=>{e.ok&&(setSearchState.pref.f_jobs=e.data.favourite_jobs)}).catch(e=>{})}),$("#share__handle").on("click",()=>{$("#shareModalCenter").modal("show"),shareHandler.urlGen("fb"),shareHandler.urlGen("tw"),shareHandler.urlGen("wtp"),$("html").css("overflow","hidden")}),$("#closeShareModal").on("click",()=>{$("#shareModalCenter").modal("hide"),$("html").css("overflowY","scroll")}),$("#shareModalCenter").on("hide.bs.modal",()=>{$("html").css("overflowY","scroll")}).on("hidden.bs.modal",()=>{$("#share__handle").removeClass("button-active")}),$("#whatsappShare").on("click",()=>{shareHandler.shareType="whatsapp"}),$("#filter__init-call").on("click",()=>{$(".filter-list").toggleClass("show-filter-menu")}),$("#filter__init-dismiss").on("click",()=>{$(".filter-list").toggleClass("show-filter-menu")}),$("._alert").on("click",e=>{notificationHandler.state.menu_open?notificationHandler.state.menu_open=!1:notificationHandler.state.menu_open=!0,$(".notif__display").toggleClass("show__notif__display"),$(".active_nav__indicator").toggle(),$("#nav_me").fadeOut()}),$("._me").on("click",e=>{$("#nav_me").toggle(),$("#nav_me").toggleClass("open__dropdown")}),$("#nav_me").on("mouseleave",()=>{$("#nav_me").fadeOut()}).on("mouseenter",()=>{$("#nav_me").show()}),$("#nav-search_button").on("click",()=>{$(".search-field").show(),$("#autoComplete").focus(),$(".search-nav-links").hide(),$("#search-page-nav-logo").toggle(),$(".focus___overlay").show()}),$(".focus___overlay").on("click",()=>{$("#career-search").val(""),$("#career-search").blur(),$(".focus___overlay").hide(),$(".search-field").hide(),$("#search-page-nav-logo").show(),$(".search-nav-links").show()}),$("#autoComplete").on("focus",()=>{$(".focus___overlay").show(),$(window).width()<=1020&&($("#search-page-nav-logo").fadeOut(),$(".search-nav-links").hide())}).on("blur",e=>{var a=$(window).width();$(".focus___overlay").hide(),$(".search-nav-links").show(),a<=1020&&($("#search-page-nav-logo").fadeIn(),$(".search-field").hide(),$(".focus___overlay").hide())}),$(window).on("scroll",()=>{$("#nav_alert").hide(),$("#nav_me").hide(),$(window).scrollTop()>10?($(".navbar").addClass("scroll-nav"),$(".navbar").addClass("bg-dark"),$(".navbar").removeClass("sticky-top"),$(".navbar").addClass("fixed-top"),$("nav").addClass("scroll-nav"),$(window).width()<=1020&&$("#search-page-nav-logo").fadeIn()):($(".navbar").removeClass("scroll-nav"),$(".navbar").removeClass("bg-dark"),$(".navbar").removeClass("fixed-top"),$(".navbar").addClass("sticky-top"),$("nav").removeClass("scroll-nav"))}).on("resize",async()=>{$(window).width()>=1020?($("#search-page-nav-logo").show(),$(".search-field").show(),$(".search-nav-links").show(),$(".job-show-display").removeClass("show-job-section")):($(".search-field").hide(),$(".search-nav-links").show(),$("#nav"),$("#locationMenu").show(),$("#companyMenu").show(),$("#jobTypeMenu").show())}).on("load",async()=>{setSearchState.setState(),setSearchState.setUserPref();$(window).width()>1020?($("#search-page-nav-logo").show(),$(".search-nav-links").show(),$(".search-field").show()):$(".search-field").hide(),fetch("/resources/alljobs.json").then(e=>e.json()).then(e=>{for(let a=0;a<e.length;a++)autoCompleteJS.data.src.push(e[a].title)})}),$("#jobTypeButton").on("click",()=>{$(window).width()>=1020&&($("#jobTypeMenu").toggle(),$("#locationMenu").hide(),$("#quickApplyMenu").hide(),$("#sortResultMenu").hide(),$("#companyMenu").fadeOut())}),$("#jobTypeMenu").on("mouseleave",()=>{$(window).width()>=1020&&$("#jobTypeMenu").fadeOut()}),$("#locationButton").on("click",()=>{$(window).width()>=1020&&($("#locationMenu").toggle(),$("#jobTypeMenu").hide(),$("#quickApplyMenu").hide(),$("#sortResultMenu").hide(),$("#companyMenu").fadeOut())}),$("#locationMenu").on("mouseleave",()=>{$(window).width()>=1020&&$("#locationMenu").fadeOut()}),$("#quickApplyButton").on("click",()=>{$(window).width()>=1020&&($("#quickApplyMenu").toggle(),$("#sortResultMenu").hide(),$("#jobTypeMenu").hide(),$("#locationMenu").hide(),$("#companyMenu").fadeOut())}),$("#quickApplyMenu").on("mouseleave",()=>{$(window).width()>=1020&&$("#quickApplyMenu").fadeOut()}),$("#sortButton").on("click",()=>{$(window).width()>=1020&&($("#sortResultMenu").toggle(),$("#locationMenu").hide(),$("#jobTypeMenu").hide(),$("#quickApplyMenu").hide(),$("#companyMenu").fadeOut())}),$("#sortResultMenu").on("mouseleave",()=>{$(window).width()>=1020&&$("#sortResultMenu").fadeOut()}),$("#companyButton").on("click",()=>{$(window).width()>=1020&&($("#companyMenu").toggle(),$("#sortResultMenu").hide(),$("#locationMenu").hide(),$("#jobTypeMenu").hide(),$("#quickApplyMenu").hide())}),$("#companyMenu").on("mouseleave",()=>{$(window).width()>=1020&&$("#companyMenu").fadeOut()}),$(".job-card").on("click",()=>{$(window).width()<=1020&&($(".job-show-display").addClass("show-job-section"),$("html").css("overflow","hidden"))}),$(".return_to_home").on("click",()=>{$(window).width()<=1020&&($(".job-show-display").removeClass("show-job-section"),$("html").css("overflowY","scroll"))}),$("#applyButtonInit").on("click",async()=>{applicationHandler.setState(),$("#applicationModal").modal("show"),$("html").css("overflowY","hidden")}),$("#applicationModal").on("hidden.bs.modal",()=>{$("html").css("overflowY","scroll"),applicationHandler.resetState()}),$("#applicantPHONEInput").on("keyup",async()=>{var e=$("#applicantPHONEInput").val(),a=await phoneFormatter(e);$("#applicantPHONEInput").val(a)}).on("blur",async()=>{var e=$("#applicantPHONEInput").val(),a=await phoneFormatter(e);$("#applicantPHONEInput").val(a),e.length<10?($("#applicantPHONEInput").addClass("is-invalid"),$("#applicantPHONEInput").removeClass("is-valid"),applicationHandler.conditions.step_one.phone=!1):($("#applicantPHONEInput").addClass("is-valid"),$("#applicantPHONEInput").removeClass("is-invalid"),applicationHandler.conditions.step_one.phone=!0)}),$("#applicantEMAILInput").on("change",async()=>{var e=$("#applicantEMAILInput").val();console.log("works"),(await validEmailCheck(e)).ok?($("#applicantEMAILInput").addClass("is-valid"),$("#applicantEMAILInput").removeClass("is-invalid"),applicationHandler.conditions.step_one.email=!0):($("#applicantEMAILInput").addClass("is-invalid"),$("#applicantEMAILInput").removeClass("is-valid"),applicationHandler.conditions.step_one.email=!1)}),$("#applicantNAMEInput").on("change",()=>{applicationHandler.u_Data.name.length>2?($("#applicantNAMEInput").addClass("is-valid"),$("#applicantNAMEInput").removeClass("is-invalid"),applicationHandler.conditions.step_one.name=!0):($("#applicantNAMEInput").addClass("is-invalid"),$("#applicantNAMEInput").removeClass("is-valid"),applicationHandler.conditions.step_one.name=!1)}),$("#applicantCOUNTRYInput").on("change",()=>{applicationHandler.u_Data.country.length>2?($("#applicantCOUNTRYInput").addClass("is-valid"),$("#applicantCOUNTRYInput").removeClass("is-invalid"),applicationHandler.conditions.step_one.country=!0):($("#applicantCOUNTRYInput").addClass("is-invalid"),$("#applicantCOUNTRYInput").removeClass("is-valid"),applicationHandler.conditions.step_one.country=!1)}),$("#applicantRESUMEInput").on("change",()=>{var e=$("#applicantRESUMEInput").val().split(".")[1],a=!1;a=!!["docx","doc","pdf","txt"].includes(e.toLowerCase()),$("#applicantRESUMEInput").val().length>0&&a?($("#applicantRESUMEInput").addClass("is-valid"),$("#applicantRESUMEInput").removeClass("is-invalid"),applicationHandler.conditions.step_one.resume=!0):($("#applicantRESUMEInput").addClass("is-invalid"),$("#applicantRESUMEInput").removeClass("is-valid"),applicationHandler.conditions.step_one.resume=!1)}),$("#successDismiss").on("click",()=>{$("#applicationModal").modal("hide"),applicationHandler.resetState()}),$("#errorDismiss").on("click",()=>{applicationHandler.resetState()})};$(document).ready(main);