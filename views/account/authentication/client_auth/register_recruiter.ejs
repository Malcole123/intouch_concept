<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../../css/user.css" />
    <!----Font Awesome CDN-->
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <!----Boot-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <title>Intouch|Register Recruiter</title>
  </head>
  <body>
    <section class="main">
      <a href="/main/home"><img src="/images/logo.svg" alt="Intouch logo" style="width:7em; position:absolute;top:1%;left:50%;transform:translateX(-50%);"></a>
        <div class="container">
            <div class="sign-up-form">
                <h3 class="text-center">You were invited to join the team at <%=invitingCompany%></h3>
                <p class="mt-3 text-center">You were invited by <strong>Employer Name</strong> to join the team at <strong>Company Name</strong></p>
                <div class="form-feedback">
                  <p id="formFeedBack"></p>
                </div>
                <form class="needs-validation" id="register-form" method="POST" action="/employer/auth/register/client" @submit.prevent="processForm" novalidate @change ="checkFormReady">
                      <div class="row g-2 mt-2">
                        <div class="col-12 ">
                          <div class="form-floating">
                            <input type="password" class="form-control" id="createpasswordInput" placeholder="password" v-model.trim="password" @blur="checkPassReq">
                            <label for="createpasswordInput">Create password:</label>
                                <div class="invalid-feedback">
                                </div>
                          </div>
                        </div>
                        <div class="col-12">
                            <div class="form-floating">
                              <input type="password" class="form-control" id="confirmpasswordInput" placeholder="password" v-model.trim="passConfirm" @blur="checkPassMatch">
                              <label for="confirmpasswordInput">Confirm password:</label>
                              <div class="invalid-feedback">
                                </div>
                            </div>
                          </div>
                      </div>
                      <div class="row mt-2 d-none" id="passwordReqDisplay">
                            <p>Your password must:</p>
                            <div class="col-12 d-flex justify-content-start flex-wrap">
                                <p class="pass-req"><i class="fas fa-check-double"></i> Be betweeen 8 -32 characters</p>
                                <p class="pass-req"><i class="fas fa-check-double"></i> Must have atleast one uppercase letter.</p>
                                <p class="pass-req"><i class="fas fa-check-double"></i> Must have atleast one number.</p>
                            </div>
                      </div>
                      <div class="row mt-3">
                        <div class="col-12">
                            <label class="form-check-label" for="termsandServiceagree">
                              By signing up you agree to our <a href="/legal/terms_of_service" target="_blank" class="text-primary pe-auto">terms and services </a>
                            </label>
                            <div class="invalid-feedback">
                            </div>

                          </div>
                      </div>
                      <div class="row mt-3">
                        <div class="col-12 d-flex flex-column justify-content-center align-items-center g-3">
                            <button class="btn btn-dark" type="submit" v-if="!processing">
                                Join Team
                            </button>
                            <div class="spinner-border" role="status" v-if="processing">
                              <span class="sr-only">Loading...</span>
                            </div>
                        </div>  
                      </div>         
                    
                </form>
            </div>
        </div>
    </section>
  </body>
  <script defer>
    const newRecruit = new Vue({
      el:"#register-form",
      data(){
        fname = ""
        lname = ""
        email = ""
        company = ""
        password = ""
        phoneNumber = ""
        passConfirm = ""
        processing = false
        formReady = false
        errors = {
          passwordMatch:false,
          passwordReq:false
        }
        setState = ()=>{
          var search = window.location.search.split('&');
          set_OBJ = {
            fname:search[0].replace('?fName=',''),
            lname:search[1].replace('lName=',''),
            company:search[2].replace('company=',''),
            email:search[4].replace('email=','')
          }
          this.fname =decodeURIComponent(search[0]).replace('?fName=','') 
          this.lname =decodeURIComponent(search[1]).replace('lName=','')
          this.email =decodeURIComponent(search[4]).replace('email=','')
          this.company = decodeURIComponent(search[2]).replace('company=','')
          console.log(this.company,this.email)
        }
        checkPassReq=()=>{
            var val = this.password;
            const numberChecker = (str)=>{
                var numberFound = false;
                for(let i =0; i < str.length; i++){
                    var check = str[i];
                     var regex = /^[0-9]+$/;
                     if(regex.test(check)){
                         numberFound = true;
                         i =str.length
                     }
                }
                return numberFound
            }
            const caseChecker = (str)=>{
                var upperCaseFound = false;
                for(let i = 0; i < str.length; i++){
                    var checkLetter = str[i];
                    var regex = /^[A-Z]+$/;
                    if(regex.test(checkLetter)){
                        upperCaseFound = true;
                        i = str.length
                    }
                }
                return upperCaseFound
           }
            const lengthChecker = (str)=>{
               var lengthMet = false;
               if(str.length >= 8){
                   lengthMet = true
               }
               return lengthMet
           }
           var num = numberChecker(val);
           var cas = caseChecker(val);
           var len = lengthChecker(val);
           if(val.length > 0 ){
            if((num && cas)&&len){
                setvalid('createpasswordInput');
                this.errors.passwordReq = false;
                return true
            }else{
                setInvalid('createpasswordInput');
                this.errors.passwordReq = true;
                return false
            }
           }else{
               return false
           }
        },
        checkPassMatch=()=>{
            var val = this.passConfirm
            var compIn = document.querySelector('#createpasswordInput');
            var comp = compIn.value;
            if(val.length > 0){
                if(val === comp){
                    setvalid('confirmpasswordInput');
                    this.errors.passwordMatch = false;
                    return true
                }else{
                    setInvalid('confirmpasswordInput');
                    this.errors.passwordMatch = true;
                    return false
                }
            }else{
                return false
            }
        },
        checkFormReady =()=>{
          setState()
            var fn, ln, em, pn, ps, pc,tos;
            ps = checkPassReq();
            pc = checkPassMatch();      
            if(ps && pc){
                this.formReady = true
            }else{
                this.formReady = false
            }

        }
        processForm =()=>{
            var form = document.getElementById('register-form');
            var ePoint = form.getAttribute('action');
            var userType = 'client';
                var sendData = {
                fn:this.firstName,
                ln:this.lastName,
                em:this.email,
                pn:this.phoneNumber,
                ps:this.password,
                tos:true,
                user_type:userType,
                end:''
            };
            const processor = async ()=>{
                var r = await cEnroll(sendData.fn, sendData.ln, sendData.em, sendData.pn,sendData.ps, sendData.tos,sendData.user_type,ePoint);
                if(r.completed){
                    window.location.href = r.redPath  
                }else{
                    this.processing = false
                    setInvalid('emailInput');
                }            
            }
            if(this.formReady){
                this.processing = true;
                this.formReady = false
                processor()
            }else{
                checkForErrors()
            }

        }
        checkForErrors =()=>{
            var data = Object.values(this.errors);
            for(let i = 0; i < data.length; i++){
                if(data[i]){
                    i = data.length
                    return true
                }else{
                    return false
                }
            }
        }
      }
    })



</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
</html>
