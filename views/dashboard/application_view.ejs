<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Language" content="en" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>View applications</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"
    />
    <meta name="description" content="View your applications" />
    <meta name="msapplication-tap-highlight" content="no" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14" defer></script>
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
      defer
    ></script>
    <script src="/js/dashboard/main.js" defer></script>
    <script
      type="module"
      src="/js/dashboard/application_control.js"
      defer
    ></script>
    <link href="/css/dashboard/main.css" rel="stylesheet" />
    <link href="/css/dashboard/applications.css" rel="stylesheet" />
    <link rel="icon" type="image/x-icon" href="/images/logo-small.png" />
    <style>
        .app-dt-row{
            width:100%;
            padding:6px 0;
            display:flex;
            justify-content:space-between;
            align-items:center;
        }
        .app-dt-row span{
            font-weight:600;
        }
        .comment-area{
            width:100%;
            height:150px;
            overflow-y:scroll;
            display:grid;
            grid-template-columns:1fr;
            gap:15px;
            border-bottom:1px solid #ddd;
            padding:0 0 20px 0;
        }
        .comment-area::-webkit-scrollbar{
            width:6px;
        }
        .comment-area::-webkit-scrollbar-track{
            width:6px;
            background:rgb(243, 242, 242);
        }
        .comment-area::-webkit-scrollbar-thumb{
            width:6px;
            background:#ddd;
            border-radius:8px;
        }
        .comment-section h6{
            font-weight:600;
        }
        .comment{
            display:flex;
            flex-direction:column;
            padding:6px 0;
            gap:10px;
            height:fit-content
        }
        .comment >*:nth-child(1){
            font-weight:600;
        }
        .comment:nth-child(even){
            border-bottom:0.4px solid #ddd;
            border-top:0.4px solid #ddd;
        }

    </style>
  </head>
  <body>
    <div
      class="app-container app-theme-white body-tabs-shadow fixed-sidebar fixed-header"
      id="browse-page"
    >
      <div class="app-header header-shadow">
        <div class="app-header__logo">
          <div class="logo-src"></div>
          <div class="header__pane ml-auto">
            <div>
              <button
                type="button"
                class="hamburger close-sidebar-btn hamburger--elastic"
                data-class="closed-sidebar"
              >
                <span class="hamburger-box">
                  <span class="hamburger-inner"></span>
                </span>
              </button>
            </div>
          </div>
        </div>
        <div class="app-header__mobile-menu">
          <div>
            <button
              type="button"
              class="hamburger hamburger--elastic mobile-toggle-nav"
            >
              <span class="hamburger-box">
                <span class="hamburger-inner"></span>
              </span>
            </button>
          </div>
        </div>
        <div class="app-header__menu">
          <span>
            <button
              type="button"
              class="btn-icon btn-icon-only btn btn-primary btn-sm mobile-toggle-header-nav"
            >
              <span class="btn-icon-wrapper">
                <i class="fa fa-ellipsis-v fa-w-6"></i>
              </span>
            </button>
          </span>
        </div>
        <div class="app-header__content">
          <div class="app-header-left">
           
          </div>
          <%-include('../components/dashboard_components/user_actions.ejs') -%>
        </div>
      </div>
      <div class="app-main">
        <div class="app-sidebar sidebar-shadow">
          <div class="app-header__logo">
            <div class="logo-src"></div>
            <div class="header__pane ml-auto">
              <div>
                <button
                  type="button"
                  class="hamburger close-sidebar-btn hamburger--elastic"
                  data-class="closed-sidebar"
                >
                  <span class="hamburger-box">
                    <span class="hamburger-inner"></span>
                  </span>
                </button>
              </div>
            </div>
          </div>
          <div class="app-header__mobile-menu">
            <div>
              <button
                type="button"
                class="hamburger hamburger--elastic mobile-toggle-nav"
              >
                <span class="hamburger-box">
                  <span class="hamburger-inner"></span>
                </span>
              </button>
            </div>
          </div>
          <div class="app-header__menu">
            <span>
              <button
                type="button"
                class="btn-icon btn-icon-only btn btn-primary btn-sm mobile-toggle-header-nav"
              >
                <span class="btn-icon-wrapper">
                  <i class="fa fa-ellipsis-v fa-w-6"></i>
                </span>
              </button>
            </span>
          </div>
          <%-include('../components/dashboard_components/sidebar.ejs')-%>
        </div>
        <div class="app-main__outer">
          <div class="app-main__inner" id="app__body">
            <div class="app-page-title">
              <div class="page-title-wrapper">
                <div class="page-title-heading">
                  <div class="page-title-icon">
                    <i class="pe-7s-note2 icon-gradient bg-mean-fruit"> </i>
                  </div>
                  <div>
                    Applications for {{ all_data.title }}
                    <div class="page-title-subheading"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row g-2">
                <div
                class="col-lg-4 col-md-6 col-sm-12"
                v-for="(app,index) in app_data"
                :key="app"
              >
                <div
                  class="main-card mb-3 card __table__card"
                  style="height: fit-content"
                >
                  <div
                    class="d-flex justify-content-between border-0 card-header"
                  >
                    <!--Name-->
                    {{ app.name }}
                    <div class="d-flex g-2 card-header__right">
                      <!--Possibly place an arrow to navigate with a link-->
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="scroll-area-s">
                      <div class="scrollbar-container ps--active-y">
                        <p>Email: {{app.email}}</p>
                        <p class="mt-1">Phone: {{app.phone_number}}</p>
                        <p class="text-transform:capitalize">Status: {{app.status.replaceAll('_','&nbsp;')}}</p>
                        <div
                          class="d-flex align-items-end justify-content-end mt-auto cta-l"
                        >
                          <button
                            class="btn btn-outline-dark"
                            data-bs-toggle="modal"
                            data-bs-target="#exampleModal"
                            @click="focusApp(index)"
                          >
                            View Resume
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-12 d-flex justify-content-center" v-if="app_data.length === 0">
                  No applications found
              </div>
            </div>
          </div>
          <div class="app-wrapper-footer">
            <div class="app-footer">
              <div class="app-footer__inner">
                <div class="app-footer-left">
                  <ul class="nav">
                    <li class="nav-item">
                      <a href="javascript:void(0);" class="nav-link"> </a>
                    </li>
                    <li class="nav-item">
                      <a href="javascript:void(0);" class="nav-link"> </a>
                    </li>
                  </ul>
                </div>
                <div class="app-footer-right">
                  <ul class="nav">
                    <li class="nav-item">
                      <a href="javascript:void(0);" class="nav-link"> </a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Modal -->
      <div
        class="modal fade"
        id="exampleModal"
        tabindex="-1"
        aria-labelledby="exampleModalLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header border-0 bg-white">
              <h5 class="modal-title" id="exampleModalLabel">{{focus.name}}</h5>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body" style="max-height:540px">
                <div class="row">
                    <div class="col-lg-6 col-md-6 col-sm-12">
                        <div class="app-dt-row">
                            <h6>Application submitted</h6>
                            <span>{{focus.created_at_str}}</span>
                        </div>
                        <div class="app-dt-row">
                            <h6>Current Status</h6>
                            <span style="text-decoration:capitalize;">{{focus.status.replace('_',' ')}}</span>
                        </div>
                        <div class="app-dt-row">
                            <h6>Email</h6>
                            <span style="text-decoration:lowercase;">{{focus.email}}</span>
                        </div>
                        <div class="app-dt-row">
                            <h6>Phone</h6>
                            <span>{{focus.phone}}</span>
                        </div>
                        <div class="app-dt-row">
                            <h6>Resume</h6>
                            <a type="button" class="btn btn-success" :download="focus.resume_ref" target="_blank">Download Resume</a>
                        </div>
                        <div class="comment-section mt-3 h-25 w-100 border-1-dark">
                            <h6>Comments</h6>
                            <div class="comment-area">
                                <div class="comment" v-for="(comment,index) in focus.comments" :key="comment.index">
                                    {{comment.comment}}
                                    <small>Made by {{comment.made_by}}</small>
                                </div>
                                <p v-if="focus.comments.length === 0">No comments made</p>
                            </div>
                            <div class="comment-input-area h-25 mt-2">
                                <form @submit.prevent="makeComment">
                                    <textarea class="form-control" v-model:trim="inputs.comment" maxlength="200" style="resize:none;"></textarea>
                                    <button type="submit" class="btn btn-outline-primary mt-1">Leave a comment..</button>    
                                    <small>{{200 - inputs.comment.length}} / 200 characters remaining</small>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="col">
                        <h5>Pre-screening Answers</h5>
                        <div class="answer" v-for="quest in focus.pre_screen" :key="quest">
                            <h6 class="mb-1">{{quest.question.question}}</h6>
                            <p>{{quest.answer}}</p>
                        </div>
                        <p v-if="focus.pre_screen.length === 0">Nothing to see here..</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 bg-white d-flex justify-content-end">
              <div class="dropdown d-inline-block">
                <button type="button" aria-haspopup="true" aria-expanded="false" data-toggle="dropdown" class="dropdown-toggle btn btn-primary">Change Status</button>
                <div tabindex="-1" role="menu" aria-hidden="true" class="dropdown-menu">
                    <button type="button"tabindex="0" class="dropdown-item btn btn-success" @click="changeStatus('short_listed')">Short List &nbsp <i v-if="focus.status==='short_listed'"class="pe-7s-check" ></i></button>
                    <button type="button" tabindex="0" class="dropdown-item btn btn-secondary" @click="changeStatus('reviewed')">Reviewed &nbsp <i v-if="focus.status==='reviewed'"class="pe-7s-check"></i></button>
                    <button type="button" tabindex="0" class="dropdown-item btn btn-danger" @click="changeStatus('denied')">Reject &nbsp <i v-if="focus.status==='denied'"class="pe-7s-check"></i></button>
                    <button type="button" tabindex="0" class="dropdown-item btn btn-info" @click="changeStatus('interviewed')">Interviewed &nbsp <i v-if="focus.status==='interviewed'"class="pe-7s-check"></i></button>
                    <button type="button" tabindex="0" class="dropdown-item btn btn-dark" @click="changeStatus('contacted')">Contacted &nbsp <i v-if="focus.status==='contacted'"class="pe-7s-check"></i></button>

                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
    crossorigin="anonymous"
  ></script>
</html>
